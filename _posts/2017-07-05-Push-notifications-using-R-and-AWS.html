---
layout: post
title:  "Push notifications using R and AWS"
date:   2017-07-05
---
<meta charset="UTF-8">

My girlfriend and I are in the midst of buying a house, hence we need to take out a mortage - preferably at the best possible price. Therefore I want to keep myself updated on the current price of the mortage we are eyeing in order to strike when the price is just right.        <a target="_blank" href="https://github.com/flovv/Roxford">Roxford</a> <i>(Apparently the project was previously called Project Oxford)</i>.

<br>
<br>

To my surprise I was unsuccesful in finding any kind of service that would shoot a daily notification to me containing the current mortage price (Well, I wanted to test out a solution in R, so i didn't bother looking THAT hard for suitable service). So that's what I'm trying to achieve and describe in this post!

<br>
<br>

The tools needed are:

<br>

<ul>
  <li>R and Rstudio</li>
  <li>Amazon Web Services (AWS)</li>
  <li>MobaXterm</li>
  <li>Pushover.net API</li>
</ul>

<br>
<br>

I have Rstudio set up on a virtual linux machine from AWS - I won't go over how to install Rstudio on a virtual machine, I followed <a target="_blank" href="http://blog.yhat.com/posts/r-in-the-cloud-part-1.html">this</a> and <a target="_blank" href="https://www.r-statistics.com/2015/06/setting-rstudio-server-using-amazon-web-services-aws-a-step-by-step-screenshots-tutorial/">this</a> tutorial and I suggest you do the same. The next step is to write a R script that scrapes a website for mortage prices and use <a target="_blank" href="https://pushover.net/">Pushovers</a> API to send out a notification and then schedule this script to run daily. MobaXterm is used to remotely access the virtual linux machine and set a cron job to run the R script daily.

<br>
<br>

Lets get started on the R script


<script type="text/javascript">

 library(shiny)
 library(Roxford)
 library(shinythemes)

 # Build the ui part -------------------------------------------------------

 ui <- shinyUI(
   fluidPage(theme=shinytheme("superhero"),
             sidebarLayout(
               sidebarPanel(
                 titlePanel("Insert the image URL"), h5("Copy and paste e.g. this url and hit send"),
                 textInput("url", label = h5("http://static.wixstatic.com/media/8dc02a_c68673e648754a7593b66cbfb5e1f6f5~mv2.jpg")), submitButton("Send"),
                 hr(),
                 fluidRow(verbatimTextOutput("text"))),
               mainPanel(
                 fluidRow(column(3, htmlOutput("image"))))
             )
   )
 )

 </script>

<pre style="background-color:#2c6b46;color:white;font-size:13px;">
  #################################### BASICS #############################################

  # Author: Mads Bønding
  # Date:05-07-2017
  # Document version: 1.0
  # R version: 3.3.2 sessionInfo()
  # R Studio: 1.0.44
  # Purpose: Scrape mortage prices and send a daily push notification with current price to my phone/watch using R, AWS and Pushover.


  ################################## LIBRARIES ############################################
  library(dplyr) # v. 0.4.3
  library(tidyr) # v. 0.4.1
  library(rvest) # v. 0.3.2
  library(spaRnord) # v. 0.1.1

  ################################# DATA WRANGLING ###########################################

  # read and store the url
  obl_2pct_uafdrag <- read_html("http://www.sydbank.dk/investering/analyser/obligationer/obligation?kode=DK0009504755&type=Obligation&sektor=NONE&straks=true")

  # Extract the relavent nodes
  current_price <- obl_2pct_uafdrag %>%
    html_node("td:nth-child(3)") %>%
    html_text() %>%
    as.character()

  daily_change <- obl_2pct_uafdrag %>%
    html_node("td:nth-child(7)") %>%
    html_text() %>%
    as.character()

  # User key to be used in the send_push function
  userkey <- 'uxno32z76kp6cj282n1nczftgx43px'

  message <- paste("Kursen på 2.pct uden afdrag er idag ",current_price, " og har ændret sig ", daily_change, " siden igår.")

  send_push(userkey, message, title = "2. pct uden afdrag")

</pre>

<br>
<br>

<br>
<br>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'madsboending';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
